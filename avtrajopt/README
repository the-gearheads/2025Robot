yes the code is ugly and the mathematical terminology is a bit wrong probably

and there's probably an off by one error lurking somewhere